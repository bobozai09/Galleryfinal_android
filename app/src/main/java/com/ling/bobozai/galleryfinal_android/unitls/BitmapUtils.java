package com.ling.bobozai.galleryfinal_android.unitls;import android.graphics.Bitmap;import android.graphics.BitmapFactory;import android.text.TextUtils;import java.io.File;import java.io.FileInputStream;import java.io.FileNotFoundException;import java.io.IOException;import java.io.InputStream;/** * Created by boboz on 2018/3/24. */public class BitmapUtils {    /**     * 判断本地图片是否有效     *     * @param path     * @return     */    public static boolean isInvalidPic(String path) {        if (TextUtils.isEmpty(path) || !new File(path).exists()) {            return true;        }        Bitmap bitmap = BitmapUtils.decodeBmpLowMemory(path);        if (bitmap == null) {            return true;        }        bitmap.recycle();        bitmap = null;        System.gc();        return false;    }    /**     * Funciton:以最省内存的方式读取本地资源的图片     *     * @param path     * @return     */    public static Bitmap decodeBmpLowMemory(String path) {        BitmapFactory.Options opt = new BitmapFactory.Options();        getLowMemoryOptions(opt);        InputStream is = null;        Bitmap bitmap = null;        try {            is = new FileInputStream(path);            bitmap = BitmapFactory.decodeStream(is, null, opt);        } catch (FileNotFoundException e) {           // LogUtil.w("decodeBmpLowMemory(path)", e);        } finally {            if (is != null) {                try {                    is.close();                    is = null;                } catch (IOException e) {                   // LogUtil.w("decodeBmpLowMemory(path)", e);                }            }        }        return bitmap;    }    /**     * 设置BitmapFactory.Options以最省内存方式配置     *     * @param options     */    public static BitmapFactory.Options getLowMemoryOptions(BitmapFactory.Options options) {        // Bitmap.Config.ALPHA_8,Bitmap.Config.ARGB_4444,Bitmap.Config.RGB_565        // 设置这几个参数效果都差不多，确实相当省内存啊，而且还跟原图清晰度相当        // 【注意】：Bitmap.Config.ALPHA_8貌似只对PNG图片有效果，因为只有PNG形式的图片有透明度特性        options.inPreferredConfig = Bitmap.Config.RGB_565;// //默认为Bitmap.Config.ARGB_8888        // 以下两个设置必须配合用才会有效        options.inPurgeable = true;        options.inInputShareable = true;// 当系统内存不够时候图片自动被回收        return options;    }}